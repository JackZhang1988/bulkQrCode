<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
</head>

<style>
	.qrCode{
		display: inline-block;
		margin: 20px;
	}
	.result{
		margin-top: 20px;
	}
</style>
<body>
	<div id="wrapper">
		<div class="tempInput">
			<input type="file" accept=".xls" id="qrListInput">
			<button onclick="javascript:print()">打印</button>
		</div>
		<div class="guider">
			<blockquote>
			</blockquote>
		</div>
		<div id="result">	
		</div>
	</div>
	<script src="bower_components/jquery/dist/jquery.js"></script>
	<script src="bower_components/jquery.qrcode/dist/jquery.qrcode.js"></script>
	<script src="bower_components/js-xls/dist/xls.js"></script>
	<script type="text/javascript">
		function createQrEle(classOrder){
			var qrEle=document.createElement('div');
			qrEle.className='qrCode'+classOrder+" qrCode";
			$('#result').append(qrEle);
		}
		function renderQr(ele,ops){
			$(ele).qrcode(ops);
		}


		function handleFileSelect(evt){
			console.log(evt);
			var reader=new FileReader();
			reader.readAsBinaryString(evt.target.files[0]);
			reader.onload=function(e){
				var wb = XLS.read(e.target.result,{type:'binary'});
				var qrInfoList=[];
				console.log(wb.Sheets.Sheet1);
				// revert to qrcode obj info
				var columnLength=wb.Sheets.Sheet1['!range'].e.c;
				var rowLength=wb.Sheets.Sheet1['!range'].e.r;
				var allExcelData=wb.Sheets.Sheet1;
				var qrParaData=[];
				// for(var v in allExcelData){
				// 	if(allExcelData.hasOwnProperty(v)){
				// 		qrParaData.push(allExcelData[v].v);
				// 	}
				// }
				// console.log(qrParaData);
				// var qrData=qrParaData.slice(2,qrParaData.length-2);
				// var qrParaData=wb.Strings.slice(0,columnLength);

				// for(var i=0,j=qrData.length;i<j;){
				// 	var d={};
				// 	for(var n=0;n<columnLength;n++){
				// 		d[qrParaData[n].t]=typeof qrData[i] === "undefined" ? "":qrData[i];
				// 		i++;
				// 	}
				// 	qrInfoList.push(d);
				// }
				// console.log(qrInfoList);
				// createQrFromList(qrInfoList);
				var temp=[],i=0,j=0,result=[],tempObj={};
				for(data in allExcelData){
					if(i<columnLength){
						temp.push(allExcelData[data].v);
						i++;
						continue;
					}
					if(j<columnLength){
						tempObj[temp[j++]]=allExcelData[data].v;
					}else{
						result.push(tempObj);
						tempObj={};
						j=0;
					}
				}
				console.log(result);
			}
		}
		var qrDefalut={
			render:'image',
			mode:2,
			ecLevel:'H',
			mSize:0.05,
			size:250,
			}
		function createQrFromList(qrl){
			qrl.forEach(function(value,index){
				createQrEle(index);
				renderQr(".qrCode"+index,$.extend(qrDefalut,value));
			})
		}
		function init(){
			document.getElementById('qrListInput').addEventListener('change',handleFileSelect,false);
		}

		init();
	</script>
</body>
</html>