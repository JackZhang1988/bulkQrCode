<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
</head>

<style>
	.qrCode{
		display: inline-block;
		margin: 20px;
	}
	.result{
		margin-top: 20px;
	}
</style>
<body>
	<div id="wrapper">
		<div class="tempInput">
			<input type="file" accept=".xls" id="qrListInput">
			<button onclick="javascript:print()">打印</button>
		</div>
		<div class="guider">
			<blockquote>
			</blockquote>
		</div>
		<div id="result">	
		</div>
	</div>
	<script src="bower_components/jquery/dist/jquery.js"></script>
	<script src="bower_components/jquery.qrcode/dist/jquery.qrcode.js"></script>
	<script src="bower_components/js-xls/dist/xls.js"></script>
	<script type="text/javascript">
		function createQrEle(classIndex){
			var qrEle=document.createElement('div');
			qrEle.className='qrCode'+classIndex+" qrCode";
			$('#result').append(qrEle);
		}
		function renderQr(selector,ops){
			$(selector).qrcode(ops);
		}


		function handleFileSelect(evt){
			console.log(evt);
			var reader=new FileReader();
			reader.readAsBinaryString(evt.target.files[0]);
			reader.onload=function(e){
				var wb = XLS.read(e.target.result,{type:'binary'});
				// revert to qrcode obj info
				var columnLength=wb.Sheets.Sheet1['!range'].e.c;
				var allExcelData=wb.Sheets.Sheet1;

				var temp=[],i=0,result=[],tempObj={};
				var tempJ=0;
				for(data in allExcelData){
					if(i<columnLength){
						temp.push(allExcelData[data].v);
						i++;
						continue;
					}
					tempObj[temp[tempJ++]]=allExcelData[data].v;
					if(tempJ>=columnLength){
						result.push(tempObj);
						tempObj={};
						tempJ=0;
					}
				}
				// console.log(result);
				renderQrList(result);
			}
		}
		var qrDefalut={
			render:'image',
			mode:2,
			ecLevel:'H',
			mSize:0.05,
			size:250,
			}
		function renderQrList(qrl){
			$.each(qrl,function(index,value){
				createQrEle(index);
				renderQr(".qrCode"+index,$.extend(qrDefalut,value));
			})
		}
		function init(){
			document.getElementById('qrListInput').addEventListener('change',handleFileSelect,false);
		}

		init();
	</script>
</body>
</html>